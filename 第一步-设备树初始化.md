# 第一步：创建设备树目录结构并初始化基础文件

## 目标
为 TB-321FU Y700 Gen 3 (kirby, SM8650) 创建 LineageOS 设备树的基础结构。

## 设备信息确认
- **设备名称**：Lenovo Legion Tab Gen 3 / Y700 Gen 3
- **设备代号**：kirby
- **型号**：TB-321FU
- **芯片平台**：Qualcomm Snapdragon 8 Gen 3 (SM8650)
- **内核版本**：6.1.68
- **LineageOS 版本**：lineage-23.0 (Android 14)

## 参考设备
1. **Y700 (8gen2)** - [asphalt](https://github.com/lolipuru/android_device_lenovo_asphalt/) - 同品牌参考
2. **OnePlus Pad Pro (8gen3)** - [caihong](https://wiki.lineageos.org/devices/caihong/build/variant1/) - 同芯片平台参考

---

## 步骤 1.1：创建目录结构

```bash
cd ~/Y700-Gen3-Droidian

# 创建设备树主目录
mkdir -p device/lenovo/kirby

# 创建必要的子目录
mkdir -p device/lenovo/kirby/configs
mkdir -p device/lenovo/kirby/init
mkdir -p device/lenovo/kirby/keylayout
mkdir -p device/lenovo/kirby/overlay
mkdir -p device/lenovo/kirby/parts
mkdir -p device/lenovo/kirby/sepolicy/private
```

---

## 步骤 1.2：创建核心配置文件

### 1. AndroidProducts.mk
定义产品变体列表。

```makefile
PRODUCT_MAKEFILES := \
    $(LOCAL_DIR)/lineage_kirby.mk
```

### 2. BoardConfig.mk
定义硬件配置、分区信息、内核路径等。这是最重要的配置文件之一。

**关键配置项：**
- `TARGET_BOARD_PLATFORM`：SM8650
- `TARGET_KERNEL_SOURCE`：内核源码路径
- `TARGET_KERNEL_CONFIG`：内核配置文件（kirby_defconfig）
- 分区大小和布局
- 显示、音频、传感器等硬件配置

### 3. device.mk
定义设备特定的构建配置，包括：
- 继承的通用配置
- 设备特定的属性
- 需要包含的专有文件列表
- 系统属性覆盖

### 4. lineage_kirby.mk
主产品配置文件，定义：
- 产品名称
- 品牌、制造商
- 继承的设备配置
- 构建变体（userdebug）

---

## 步骤 1.3：参考类似设备

### 从 asphalt (Y700 8gen2) 参考：
- 设备树结构
- Lenovo 特定的配置
- 专有文件提取脚本
- 设备特定的 HAL 配置

### 从 caihong (OnePlus Pad Pro 8gen3) 参考：
- SM8650 平台配置
- 内核集成方式
- 分区布局
- 专有文件列表结构

---

## 步骤 1.4：创建基础文件模板

### 优先级顺序：

1. **AndroidProducts.mk** - 最简单，先创建
2. **lineage_kirby.mk** - 基础产品配置
3. **BoardConfig.mk** - 需要详细的硬件信息
4. **device.mk** - 依赖其他配置

---

## 下一步行动

完成第一步后，您将需要：

1. **获取设备硬件信息**
   - 分区布局（通过 `fastboot getvar all` 或设备上的 `/proc/partitions`）
   - 显示分辨率、DPI
   - 传感器列表
   - 音频配置

2. **准备内核集成**
   - 确认内核源码路径
   - 配置内核构建参数

3. **提取专有文件 (Proprietary Blobs)**
   - 从运行官方固件的设备中提取
   - 或从官方固件包中提取

---

## 注意事项

⚠️ **重要提示：**
- 设备树文件需要根据实际硬件配置进行调整
- 建议先参考 asphalt 和 caihong 的实现
- 某些配置可能需要多次调试才能正确
- 确保内核源码路径正确配置

---

## 参考资源

- [asphalt 设备树](https://github.com/lolipuru/android_device_lenovo_asphalt/)
- [caihong 构建指南](https://wiki.lineageos.org/devices/caihong/build/variant1/)
- [LineageOS 设备树指南](https://wiki.lineageos.org/devices/)

